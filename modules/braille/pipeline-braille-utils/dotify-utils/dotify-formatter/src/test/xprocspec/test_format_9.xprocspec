<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:dotify="http://code.google.com/p/dotify/"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal"
               xmlns:cx="http://xmlcalabash.com/ns/extensions"
               script="dotify-format.xpl">
  
  <x:scenario label="test_90">
    <x:documentation>
      Tests -obfl-use-when-collection-not-empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @begin {
                           content: flow(front) }
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display: block; flow: front; -obfl-use-when-collection-not-empty: footnotes">
              ⠌⠌⠌
            </p>
            <p style="display: block; flow: front; -obfl-use-when-collection-not-empty: endnotes">
              ⠡⠡⠡
            </p>
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <dynamic-sequence master="main">
                <list-of-references collection="meta/footnotes" range="document">
                  <on-collection-start>
                    <block> ⠌⠌⠌ </block>
                  </on-collection-start>
                </list-of-references>
                <list-of-references collection="meta/endnotes" range="document">
                  <on-collection-start>
                    <block> ⠡⠡⠡ </block>
                  </on-collection-start>
                </list-of-references>
              </dynamic-sequence>
            </pre-content>
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
            <item id="b">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
          </collection>
          <collection name="meta/footnotes">
            <item id="a">
              <block/>
            </item>
          </collection>
          <sequence master="main">
            <block id="x">
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠡⠡⠡</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_91">
    <x:documentation>
      Tests -obfl-underline.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 10 10 }">
            <h1 style="display: block; -obfl-underline:⠒">
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿
            </h1>
            <h2 style="display: block; -obfl-underline:⠂">
              ⠿⠿⠿⠿⠿⠿⠿⠿
            </h2>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="10" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block underline-pattern="⠒"> ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿ </block>
            <block underline-pattern="⠂"> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠂⠂⠂⠂⠂⠂⠂⠂</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_92">
    <x:documentation>
      Tests combination of manual and automatic volume breaking.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ display: block; text-transform: none }
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block volume-keep-priority="1">
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_93">
    <x:documentation>
      Tests volume-break-inside: -obfl-keep(...)
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform: none }
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block volume-keep-priority="1">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
          <sequence master="main">
            <block volume-keep-priority="1">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
          <sequence master="main">
            <block volume-keep-priority="1">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_94">
    <x:documentation>
      Tests -obfl-keep-with-next-sheets.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform: none }
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            <section style="display: block">
              <h1 style="display: block">
                ⠿⠿⠿⠿⠿
              </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block">
              <h1 style="display: block; -obfl-keep-with-next-sheets: 1">
                ⠿⠿⠿⠿⠿
              </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block>
              <block>
                ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
            <block>
              <block keep-with-next-sheets="1">
                ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_95">
    <x:documentation>
      Tests truncating of long footer lines.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform: none }
                       @page {
                         size: 20 5
                         @bottom-center {
                           content: string(running-footer) }}">
            <h1 style="display: block;
                       string-set: running-footer content()">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </h1>
            <p style="display: block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="20" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <marker-reference marker="running-footer" direction="forward" scope="page" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="running-footer" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="running-footer/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block>
              <block>
                <marker class="running-footer" value="⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿"/>
              </block>
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </block>
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_96">
    <x:documentation>
      Tests counter-set: page on an element in a named flow.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page {
                        size: 15 5
                        @bottom-right {
                          content: counter(page) }}
                      @volume {
                        @begin {
                          content: flow(titlepage) }}
                      { text-transform: none }">
            <front>
              <titlepage style="display: block; flow: titlepage; counter-set: page 10">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="b" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="b" initial-page-number="10">
                <block> ⠿⠿⠿ </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="a">
            <block translate=""/>
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠚</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_97">
    <x:documentation>
      Tests collapsing of margins of nested blocks, with and without the presence of an empty block
      that "collapses through". An block with only an OBFL expression that evaluates to an empty
      string is also tested.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <section style="display:block">
              <p style="display:block">
                ⠿
              </p>
            </section>
            <section style="display:block; margin-top:1">
              <p style="display:block; margin-top:1">
                ⠿
              </p>
            </section>
            <section style="display:block; margin-top:1">
              <p style="display:block; margin-top:1; margin-bottom: 1"/>
              <p style="display:block; margin-top:1">
                ⠿
              </p>
            </section>
            <section style="display:block; margin-top:1">
              <p style="display:block; margin-top:1; margin-bottom: 1"><span style="::after { content: -obfl-evaluate('&quot;&quot;')}"/></p>
              <p style="display:block; margin-top:1">
                ⠿
              </p>
            </section>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block>
                ⠿
              </block>
            </block>
            <block margin-top="1">
              <block margin-top="1">
                ⠿
              </block>
            </block>
            <block margin-top="1">
              <block margin-top="1" margin-bottom="1"/>
              <block margin-top="1">
                ⠿
              </block>
            </block>
            <block margin-top="1">
              <block margin-top="1" margin-bottom="1"><evaluate expression="&quot;&quot;"/></block>
              <block margin-top="1">
                ⠿
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_98">
    <x:documentation>
      Tests rendering of the range of print pages covered on the current page when a print page
      break coincides with a braille page break and the first element on the new page has a top
      padding.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page {
                        size: 20 7;
                        margin-top: 1;
                        margin-bottom: 1;
                        @top-left {
                          content: string(print-page-dash, page-start-except-last)
                                   string(print-page, page-last); }}">
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">1</pagenum>
            <!-- begin page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin page -->
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">2</pagenum>
            <p style="display: block; page-break-before: always; padding-top: 1">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="20" page-height="7" duplex="true" page-number-variable="page">
            <default-template>
              <header>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="page-content"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer>
                <field>
                    <string value=""/>
                </field>
                <field>
                    <string value=""/>
                </field>
                <field>
                    <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <!-- begin page -->
            <block>
              <block>
                <marker class="print-page" value="1"/>
                <marker class="dash-print-page" value="⠒1"/>
                <marker class="print-page-dash" value="1⠒"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin page -->
            <block break-before="page">
              <block>
                <marker class="print-page/prev" value="1"/>
                <marker class="print-page" value="2"/>
                <marker class="dash-print-page/prev" value="⠒1"/>
                <marker class="dash-print-page" value="⠒2"/>
                <marker class="print-page-dash/prev" value="1⠒"/>
                <marker class="print-page-dash" value="2⠒"/>
              </block>
              <block padding-top="1">
                ⠁⠁⠁
              </block>
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                </page>
                <page>
                  <row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row/>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
</x:description>
