<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:dotify="http://code.google.com/p/dotify/"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal"
               xmlns:cx="http://xmlcalabash.com/ns/extensions"
               script="dotify-format.xpl">
  
  <x:scenario label="test_70">
    <x:documentation>
      Tests document scope table of contents in @begin area of first volume and volume scope table
      of contents in @begin are of subsequent volumes.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 15 7; @bottom-right {content: counter(page) }}
                      @volume:first { max-length: 3; @begin { content: flow(first-front) }}
                      @volume { max-length: 3; @begin { content: flow(next-front) }}
                      { text-transform: none }">
            <front>
              <h1 style="display:block; flow:first-front">
                ⠿ ⠿ ⠿ ⠿
              </h1>
              <h1 style="{ display:block; flow:first-front }
                         ::duplicate { display:block; flow:next-front }">
                ⠿⠿⠿⠿
              </h1>
              <toc style="{ display:-obfl-toc; flow:first-front; text-transform:auto }
                          ::-obfl-on-volume-start { content:-obfl-evaluate('(round $started-volume-number)') }
                          ::duplicate { display:-obfl-toc; -obfl-toc-range:volume; flow:next-front; text-transform:auto }
                          ::duplicate::-obfl-on-toc-start { content:'⠿⠿⠿' }">
                <entry ref="ch_1" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                <entry style="display:block; margin-left:1">
                  <entry ref="ch_1_1" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_1_2" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
                <entry ref="ch_2" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                <entry style="display:block; margin-left:1">
                  <entry ref="ch_2_1" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_2_2" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
              </toc>
            </front>
            <body style="display: block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              <h2 id="ch_1_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_1_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              <h2 id="ch_2_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_2_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <table-of-contents name="volume-toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_1_1">
                <toc-entry ref-id="ch_1_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_1_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
              <toc-entry ref-id="ch_2">
                2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_2" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_2_1">
                <toc-entry ref-id="ch_2_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_2_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <table-of-contents name="document-toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_1_1">
                <toc-entry ref-id="ch_1_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_1_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
              <toc-entry ref-id="ch_2">
                2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_2" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_2_1">
                <toc-entry ref-id="ch_2_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_2_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="3" use-when="(! (= $volume 1))">
            <pre-content>
              <sequence master="main">
                <block> ⠿⠿⠿⠿ </block>
              </sequence>
              <toc-sequence toc="volume-toc" master="main" range="volume">
                <on-toc-start>
                  <block translate=""> ⠿⠿⠿ </block>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <volume-template sheets-in-volume-max="3" use-when="(= $volume 1)">
            <pre-content>
              <toc-sequence toc="document-toc" master="main" range="document">
                <on-toc-start>
                  <block> ⠿ ⠿ ⠿ ⠿ </block>
                  <block> ⠿⠿⠿⠿ </block>
                </on-toc-start>
                <on-volume-start>
                  <block translate="">
                    <evaluate expression="(round $started-volume-number)"/>
                  </block>
                </on-volume-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              <block id="ch_1" translate=""> 1 </block>
              <block id="ch_1_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_1_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_2" translate=""> 2 </block>
              <block id="ch_2_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_2_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠿⠀⠿⠀⠿</row>
                  <row>⠿⠿⠿⠿</row>
                  <row>⠼⠁</row>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠙</row>
                  <row>⠼⠃</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠑</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠋</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠑</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠋</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠋</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠛</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠓</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_71">
    <x:documentation>
      Tests omitting of a table of contents entry that references an element in the volume @begin
      area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 15 7; @bottom-right {content: counter(page) }}
                      @volume { @begin { content: flow(front) }}
                      { text-transform: none }">
            <front>
              <h1 id="ch_0" style="display:block; margin-bottom:1; flow:front; text-transform:auto"> 0 </h1>
              <toc style="{ display:-obfl-toc; flow:front; text-transform:auto }">
                <entry ref="ch_0" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 0 </entry>
                <entry ref="ch_1" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                <entry style="display:block; margin-left:1">
                  <entry ref="ch_1_1" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_1_2" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
              </toc>
            </front>
            <body style="display: block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              <h2 id="ch_1_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_1_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_1_1">
                <toc-entry ref-id="ch_1_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_1_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <toc-sequence master="main" range="document" toc="toc">
                <on-toc-start>
                  <block margin-bottom="1" translate=""> 0 </block>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              <block id="ch_1" translate=""> 1 </block>
              <block id="ch_1_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_1_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠚</row>
                  <row/>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_72">
    <x:documentation>
      Tests page-break-after on elements in named flows.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @volume { @begin { content: flow(foo) flow(bar); }}">
            <level1 style="display: block; page-break-after: always; flow: foo;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: right; flow: foo;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: always; flow: bar;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: always;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block>
                  <block>⠤⠤⠤</block>
                </block>
                <block break-before="page">
                  <block>⠤⠤⠤</block>
                </block>
              </sequence>
              <sequence master="main">
                <block>
                  <block>⠤⠤⠤</block>
                </block>
                <block break-before="page"/>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block id="x">
              <block>⠤⠤⠤</block>
            </block>
            <block break-before="page"/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_73">
    <x:documentation>
      Tests page-break-before on an element with display:-obfl-toc.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@volume { @begin { content: flow(front); }}">
            <level1 style="display: block; flow: front; page-break-before: always;">
              <h1 style="display: block">⠿⠿⠿ 0</h1>
            </level1>
            <list style="display: -obfl-toc; flow: front; page-break-before: always;">
              <li style="display:block">
                <a href="ch_1" style="::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(href), page) }"> ⠿⠿⠿ 1 </a>
              </li>
            </list>
            <level1 style="display: block; page-break-before: always;">
              <h1 id="ch_1" style="display: block">⠿⠿⠿ 1</h1>
              <p style="display: block">⠤⠤⠤</p>
            </level1>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-entry ref-id="a" translate="">
              <toc-entry ref-id="a"> ⠿⠿⠿ 1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
              <page-number ref-id="a" number-format="default"/>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <toc-sequence master="main" range="document" toc="toc">
                <on-toc-start>
                  <block break-before="page" translate="">
                    <block>⠿⠿⠿ 0</block>
                  </block>
                  <block break-before="page"/>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block break-before="page" translate="" id="x">
              <block id="a">⠿⠿⠿ 1</block>
              <block>⠤⠤⠤</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠚</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠁</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_74">
    <x:documentation>
      Tests @page within @begin area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page {
                        size: 15 5;
                        @top-right {
                          content: counter(page); }}
                      @volume {
                        @begin {
                          content: flow(titlepage);
                          @page { size: 15 5 }}}">
            <front>
              <titlepage style="display: block; flow: titlepage">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="master_2" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="master_2">
                <block> ⠿⠿⠿ </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="master_1">
            <block translate=""/>
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_75">
    <x:documentation>
      Tests max-height and border-top within @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 10 6;
                         @footnotes {
                           content: flow(footnotes);
                           max-height: 4;
                           border-top-pattern: ⠒; }}">
            <p style="display:block">
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block} ::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block} ::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
            </p>
            <p style="display:block; page-break-before:always">
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="4" collection="footnotes">
              <before>
                <leader pattern="⠒" position="100%" align="right"/>
              </before>
            </page-area>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row>⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_76">
    <x:documentation>
      Tests combination of @page:left and @page:right with counter-set of 'page' to an even number.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 10 5; }
                         @page:right { @bottom-right { content: counter(page) }}">
              <p style="display:block">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display:block; counter-set: page 10">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <template use-when="(= (% $page 2) 1)">
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="b" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <template use-when="(= (% $page 2) 0)">
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
          <sequence master="b" initial-page-number="10">
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠼⠁⠚</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_77">
    <x:documentation>
      Tests word-spacing.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 15 5; }">
            <p style="display:block; word-spacing:2">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_78">
    <x:documentation>
      Tests skip-margin-top-of-page parameter.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 15 7; }">
            <div style="display: block">
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; page-break-before: always">
              <p style="display: block; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; border-top-pattern: ⠒; page-break-before: always">
              <p style="display: block; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; page-break-before: always">
              <p style="display: block; padding-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
          </body>
        </x:document>
      </x:input>
      <x:option name="skip-margin-top-of-page" select="true()"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block margin-bottom="2">
              <block margin-bottom="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
              <block margin-bottom="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
              <block margin-bottom="1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block break-before="page">
              <block>
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block border-top-style="solid" border-top-align="center" break-before="page">
              <block margin-top="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block break-before="page">
              <block padding-top="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_79">
    <x:documentation>
      Tests block with border-top, margin-left and text-indent.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 15 7; }">
            <p style="display: block; border-top-pattern: ⠒; margin-left: 2; text-indent: 2">
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block border-top-style="solid"
                   border-top-align="center"
                   margin-left="2"
                   first-line-indent="2"> ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
</x:description>
