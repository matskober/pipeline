<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:dotify="http://code.google.com/p/dotify/"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal"
               xmlns:cx="http://xmlcalabash.com/ns/extensions"
               script="dotify-format.xpl">
  
  <x:scenario label="test_60">
    <x:documentation>
      Tests display:table with render-table-by:column.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                 style="@page { size: 25 10; }
                        { display:table;
                          -obfl-table-col-spacing:1;
                          -obfl-preferred-empty-space:0;
                          render-table-by:column;
                          text-transform:none; }">
            <thead>
              <tr>
                <th colspan="2">⠤⠤⠤</th>
                <th>⠤⠤⠤</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tfoot>
            <tbody>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td rowspan="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
          </table>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-number-variable="page" page-width="25" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <table table-col-spacing="1" preferred-empty-space="0">
              <tr>
                <td row-span="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td col-span="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </table>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="25" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠀⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_61">
    <x:documentation>
      Tests flow:footnotes, @footnotes page area and ::footnote-call pseudo-element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page { size: 10 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block}
                           ::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block}
                           ::footnote-call { content:'⠶⠶' }">⠿⠿⠿⠿⠿⠿</note>
            </p>
            <p style="display:block;page-break-before:always">
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block}
                           ::footnote-call { content:'⠶' }">⠿⠿⠿⠿⠿⠿⠿⠿⠿</note>
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿⠿⠿⠿</block>
            </item>
            <item id="c">
              <block>⠿⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
            </block>
            <block break-before="page">
              ⠤⠤⠤ ⠶
              <anchor item="c"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row>⠶⠶</row>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠶</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_62">
    <x:documentation>
      Tests flow:footnotes with ::alternate pseudo-element and target-content().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page { size: 10 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_63">
    <x:documentation>
      Tests volume notes using ::alternate pseudo-element and target-content() and volume range flow().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 10 6 }
                      @volume {
                        max-length: 3;
                        @end {
                          content: flow(endnotes, volume) }}
                      { text-transform: none }">
            <body>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_1" style="::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_2" style="::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
            </body>
            <ul id="notes" style="display:none">
              <li id="note_1">
                ⠿⠿⠿
              </li>
              <li id="note_2">
                ⠿⠿⠿⠿⠿⠿
              </li>
            </ul>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="endnotes">
            <item id="a">
              <block> ⠿⠿⠿ </block>
            </item>
            <item id="b">
              <block> ⠿⠿⠿⠿⠿⠿ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="b"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_64">
    <x:documentation>
      Tests numbering of footnotes. Numbers are added both to the note itself and to the note
      reference. The numbering is not reset on each page. Two alternative methods are used for
      adding a number to the note itself.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page { size: 20 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="{ counter-increment: footnote; }
                              ::after { content: '⠦' counter(footnote) '⠴'; }
                              ::alternate {
                                flow: footnotes;
                                display: block;
                                content: counter(footnote) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="{ counter-increment: footnote; }
                              ::after { content: '⠦' counter(footnote) '⠴'; }
                              ::alternate {
                                flow: footnotes;
                                display: block;
                                content: target-content(attr(ref)); }
                              ::alternate::before { content: counter(footnote) ' '; }"/>
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
            </note>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block> <span translate="">1</span> ⠿⠿⠿ </block>
            </item>
            <item id="b">
              <block> <span translate="">2</span> ⠿⠿⠿ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠦<span translate="">1</span>⠴
              <anchor item="a"/>
              ⠤⠤⠤ ⠦<span translate="">2</span>⠴
              <anchor item="b"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠦⠼⠁⠴⠀⠤⠤⠤⠀⠦⠼⠃⠴</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠼⠃⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_65">
    <x:documentation>
      Tests chapter endnotes using flow() function in ::after pseudo-element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 20 6 } { text-transform:none }">
            <section style="{ display: block }
                            ::after { display:block; content: flow(chapter-notes)}">
              <h1 style="display:block; page-break-before:always">
                ⠤⠤⠤
              </h1>
              ⠤⠤⠤
              <note style="{flow:chapter-notes; display:block}
                           ::alternate { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: target-content(attr(ref)); }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </section>
            <section style="{ display: block }
                            ::after { display:block; content: flow(chapter-notes)}">
              <h1 style="display:block; page-break-before:always">
                ⠤⠤⠤
              </h1>
              ⠤⠤⠤
              <note style="{flow:chapter-notes; display:block}
                           ::alternate { content:'⠶⠶⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
            </section>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block break-before="page">
              <block>
                ⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤ ⠶ ⠤⠤⠤ ⠶⠶ ⠤⠤⠤
              </block>
              <block>
                <block> ⠿⠿⠿ </block>
                <block> ⠿⠿⠿ </block>
              </block>
            </block>
            <block break-before="page">
              <block>
                ⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤ ⠶⠶⠶ ⠤⠤⠤
              </block>
              <block>
                <block> ⠿⠿⠿ </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠶⠶⠶⠀⠤⠤⠤</row>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_66">
    <x:documentation>
      Tests numbering of chapter endnotes.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 20 6 } { text-transform:none; counter-reset:note; }">
            <section style="{ display: block }
                            ::after { display:block; content: flow(chapter-notes)}">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="{ counter-increment: note; }
                              ::after { content: '⠦' counter(note) '⠴'; }
                              ::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: counter(note) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="{ counter-increment: note; }
                              ::after { content: '⠦' counter(note) '⠴'; }
                              ::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: counter(note) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
            </section>
            <section class="notes" style="display:none">
              <note id="note_1">
                ⠿⠿⠿
              </note>
              <note id="note_2">
                ⠿⠿⠿
              </note>
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block> ⠤⠤⠤ ⠦<span translate="">1</span>⠴ ⠤⠤⠤ ⠦<span translate="">2</span>⠴ ⠤⠤⠤ </block>
              <block>
                <block><span translate="">1</span> ⠿⠿⠿ </block>
                <block><span translate="">2</span> ⠿⠿⠿ </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠦⠼⠁⠴⠀⠤⠤⠤⠀⠦⠼⠃⠴⠀</row>
                  <row>⠤⠤⠤</row>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠼⠃⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_67" pending="not supported yet">
    <x:documentation>
      Tests nested footnotes (noteref inside note).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 10 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠿⠿⠿
            </note>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿ ⠶⠶ ⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠀⠶⠶⠀⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_68">
    <x:documentation>
      Tests -obfl-fallback-collection with footnotes small enough to fit in the @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block> ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ </block>
            </item>
            <item id="b">
              <block> ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_69">
    <x:documentation>
      Tests -obfl-fallback-collection with footnotes too big to fit in the @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
            <item id="b">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
</x:description>
